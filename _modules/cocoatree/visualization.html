<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>cocoatree.visualization &#8212; cocoatree 0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d7e2fa82" />
    <link rel="stylesheet" type="text/css" href="../../_static/nameko.css?v=2296cfae" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <script src="../../_static/documentation_options.js?v=837179f8"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Lora:400' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  </head><body><div class="navbar related">
      <a href="../../index.html">
        
      </a>
    <ul class="nav nav-pills nav-stacked">
      <li class="right"><a href="../../auto_examples/index.html">Gallery</a> </li>
      <li class="right"><a href="../../modules/classes.html">API</a> | </li>
      <li class="right"><a href="../../install.html">Installation</a> | </li>
      <li class="right"><a href="../../index.html">Home</a> | </li>
      
    </ul>
  </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for cocoatree.visualization</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Module to visualize phylogenetic trees along with XCoRs&quot;&quot;&quot;</span>

<span class="c1"># User provided file:</span>
<span class="c1"># - phylogenetic tree in newick format</span>
<span class="c1"># - multiple sequence alignment used to generate the tree in fasta format</span>
<span class="c1"># - annotation table in csv format</span>

<span class="c1"># Import necessary packages</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ete3</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProfileFace</span><span class="p">,</span> <span class="n">TreeStyle</span><span class="p">,</span> <span class="n">NodeStyle</span><span class="p">,</span> <span class="n">TextFace</span><span class="p">,</span> \
    <span class="n">add_face_to_node</span><span class="p">,</span> <span class="n">SeqMotifFace</span><span class="p">,</span> <span class="n">RectFace</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pandas.api.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">is_numeric_dtype</span>  <span class="c1"># type: ignore</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PyQt5</span><span class="w"> </span><span class="kn">import</span> <span class="n">QtGui</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.colors</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">colors</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.cm</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cmx</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.msa</span><span class="w"> </span><span class="kn">import</span> <span class="n">compute_seq_identity</span><span class="p">,</span> <span class="n">compute_seq_similarity</span><span class="p">,</span> \
    <span class="n">compute_normalized_seq_similarity</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_annot_to_color</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">df_annot</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads in the attributes specified by the user in the annotation csv file</span>
<span class="sd">    and attributes a color palette for each.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    tree : ete3&#39;s tree object,</span>
<span class="sd">            as imported by io.load_tree_ete3()</span>

<span class="sd">    attributes : list of column names to grab</span>

<span class="sd">    df_annot : pandas dataframe of the annotation file</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    att_dict : dictionnary in which keys are the sequence IDs and the values</span>
<span class="sd">            are the colors associated with it</span>

<span class="sd">    color_dict : dictionnary in which keys are the attribute&#39;s categories and</span>
<span class="sd">            the values are the colors associated to each category</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">id_lst</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">get_leaf_names</span><span class="p">()</span>
    <span class="n">df_annot</span> <span class="o">=</span> <span class="n">df_annot</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;unknown&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_numeric_dtype</span><span class="p">(</span><span class="n">df_annot</span><span class="p">[</span><span class="s1">&#39;Seq_ID&#39;</span><span class="p">]):</span>
        <span class="n">df_annot</span><span class="p">[</span><span class="s1">&#39;Seq_ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_annot</span><span class="p">[</span><span class="s1">&#39;Seq_ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
    <span class="n">df_annot</span> <span class="o">=</span> <span class="n">df_annot</span><span class="p">[</span><span class="n">df_annot</span><span class="p">[</span><span class="s1">&#39;Seq_ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">id_lst</span><span class="p">)]</span>

    <span class="n">att_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">df_annot</span> <span class="o">=</span> <span class="n">df_annot</span><span class="p">[[</span><span class="s1">&#39;Seq_ID&#39;</span><span class="p">,</span> <span class="n">attribute</span><span class="p">]]</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">color_dict</span> <span class="o">=</span> <span class="n">_get_color_palette</span><span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">df_annot</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()),</span> <span class="n">cmap</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">color_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="n">cmap</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_annot</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())}</span>

    <span class="n">df_annot</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">attribute</span> <span class="o">+</span> <span class="s1">&#39;_color&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">df_annot</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">color_dict</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="n">attribute</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_annot</span><span class="p">[</span><span class="s1">&#39;Seq_ID&#39;</span><span class="p">])):</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">df_annot</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">att_dict</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">att_dict</span><span class="p">,</span> <span class="n">color_dict</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_generate_colors_from_colormaps</span><span class="p">(</span><span class="n">n_colors</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;jet&quot;</span><span class="p">,</span> <span class="n">as_hex</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a list of n colors from colormap</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">colormap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cmap</span><span class="p">))</span>
    <span class="n">indx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_colors</span><span class="p">)</span>
    <span class="n">indexed_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">colormap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indx</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">as_hex</span><span class="p">:</span>
        <span class="n">indexed_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">colors</span><span class="o">.</span><span class="n">to_hex</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indexed_colors</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">indexed_colors</span>


<span class="c1"># TO DO: allow user to choose which color to use for &#39;unknown&#39;</span>
<span class="c1"># (currently: white by default)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">_get_color_palette</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">cmap</span><span class="p">):</span>

    <span class="n">nvals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">_generate_colors_from_colormaps</span><span class="p">(</span><span class="n">nvals</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">as_hex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">color_dict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># key = value, value = colour id</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nvals</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;unknown&#39;</span><span class="p">:</span>
            <span class="n">color_dict</span><span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;#FFFFFF&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">color_dict</span><span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">color_dict</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_color_gradient</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function which allows to use matplotlib colormaps in ete3 heatmap</span>
<span class="sd">    Adapted from:</span>
<span class="sd">    https://github.com/lthiberiol/virfac/blob/master/get_color_gradient.py</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cNorm</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">scalarMap</span> <span class="o">=</span> <span class="n">cmx</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">cNorm</span><span class="p">,</span>
                                   <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colorscheme</span><span class="p">))</span>
    <span class="n">color_scale</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">scale</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">201</span><span class="p">):</span>
        <span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">scalarMap</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">color_scale</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QColor</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">color_scale</span>


<div class="viewcode-block" id="update_tree_ete3_and_return_style">
<a class="viewcode-back" href="../../modules/generated/cocoatree.visualization.update_tree_ete3_and_return_style.html#cocoatree.visualization.update_tree_ete3_and_return_style">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">update_tree_ete3_and_return_style</span><span class="p">(</span>
        <span class="n">tree_ete3</span><span class="p">,</span> <span class="n">df_annot</span><span class="p">,</span>
        <span class="n">xcor_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">xcor_seq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">meta_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">show_leaf_name</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">fig_title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">linecolor</span><span class="o">=</span><span class="s2">&quot;#000000&quot;</span><span class="p">,</span>
        <span class="n">bootstrap_style</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">tree_scale</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
        <span class="n">metadata_colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">t_xcor_seq</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">t_xcor_heatmap</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">matrix_type</span><span class="o">=</span><span class="s1">&#39;identity&#39;</span><span class="p">,</span>
        <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;inferno&#39;</span>
        <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update ete3 tree with XCoR info and attributes and return tree_style for</span>
<span class="sd">    further visualization.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    tree_ete3 : ete3&#39;s tree object,</span>
<span class="sd">            as imported by io.load_tree_ete3()</span>

<span class="sd">    annot_file : pandas dataframe of the annotation file</span>

<span class="sd">    xcor_id : list of XCoR sequence identifiers, as imported by io.load_msa()</span>
<span class="sd">            the ids must match with the tree&#39;s leaves id</span>

<span class="sd">    xcor_seq : corresponding list of xcor sequences to display,</span>
<span class="sd">            as imported by io.load_msa()</span>

<span class="sd">    meta_data : tuple of annotations to display</span>
<span class="sd">                 (from annotation file&#39;s header)</span>

<span class="sd">    show_leaf_name : boolean, optional, default: True</span>
<span class="sd">        whether to show leaf names.</span>

<span class="sd">    linewidth : int, optional, default: 1</span>
<span class="sd">        width of the lines in the tree</span>

<span class="sd">    linecolor : str, optional, default: &quot;#000000&quot;</span>
<span class="sd">        color of the lines</span>

<span class="sd">    bootstrap_style : dict, optional,</span>
<span class="sd">        `fgcolor`: color of the bootstrap node, default: &quot;darkred&quot;</span>
<span class="sd">        `size`: size of the bootstrap node, default: 10</span>
<span class="sd">        `support`: int between 0 and 100, minimum support level for display</span>

<span class="sd">    tree_scale : int, optional, default: 200</span>
<span class="sd">        sets the scale of the tree in ETE3: the higher, the larger the tree</span>
<span class="sd">        will be (in width)</span>

<span class="sd">    metadata_colors : dict, str, or None, optional, default: None</span>
<span class="sd">        colors for the metadata:</span>
<span class="sd">            - None: generates automatically the colors</span>
<span class="sd">            - str: uses a Matplotlib colormap to generate the colors</span>
<span class="sd">            - dict: specifies colors for each matadata entry</span>
<span class="sd">                {key: color}</span>

<span class="sd">    fig_title : figure title (str)</span>

<span class="sd">    t_xcor_seq : boolean,</span>
<span class="sd">        whether to show the sequences of the XCoR</span>

<span class="sd">    t_xcor_heatmap : boolean,</span>
<span class="sd">        whether to add a heatmap of the identity or similarity matrix between</span>
<span class="sd">        XCoR sequences</span>

<span class="sd">    matrix_type : str, default=&#39;identity&#39;</span>
<span class="sd">        whether to compute pairwise sequence identity (&#39;identity&#39;), similarity</span>
<span class="sd">        (&#39;similarity&#39;), or normalized similarity (&#39;norm_similarity&#39;).</span>

<span class="sd">    colormap : str, default=&#39;inferno&#39;</span>
<span class="sd">        the matplotlib colormap to use for the heatmap</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tree_style : TreeStyle class from ete3</span>

<span class="sd">    column_end : int, the number of columns after the tree. If you want to</span>
<span class="sd">        plot anything else alongside the tree, the column number should be</span>
<span class="sd">        equal to this value.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">tree_style</span> <span class="o">=</span> <span class="n">TreeStyle</span><span class="p">()</span>
    <span class="n">tree_style</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">tree_scale</span>
    <span class="n">tree_style</span><span class="o">.</span><span class="n">layout_fn</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># tree_style.branch_vertical_margin = 20</span>
    <span class="n">tree_style</span><span class="o">.</span><span class="n">show_leaf_name</span> <span class="o">=</span> <span class="n">show_leaf_name</span>

    <span class="c1"># Add bootstrap support NodeStyle</span>
    <span class="n">boot_style</span> <span class="o">=</span> <span class="n">NodeStyle</span><span class="p">()</span>
    <span class="n">boot_style</span><span class="p">[</span><span class="s2">&quot;fgcolor&quot;</span><span class="p">]</span> <span class="o">=</span> \
        <span class="n">bootstrap_style</span><span class="p">[</span><span class="s2">&quot;fgcolor&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;fgcolor&quot;</span> <span class="ow">in</span> <span class="n">bootstrap_style</span> \
        <span class="k">else</span> <span class="s2">&quot;darkred&quot;</span>
    <span class="n">boot_style</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span> <span class="o">=</span> \
        <span class="n">bootstrap_style</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;size&quot;</span> <span class="ow">in</span> <span class="n">bootstrap_style</span> <span class="k">else</span> <span class="mi">10</span>
    <span class="n">support</span> <span class="o">=</span> \
        <span class="n">bootstrap_style</span><span class="p">[</span><span class="s2">&quot;support&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;support&quot;</span> <span class="ow">in</span> <span class="n">bootstrap_style</span> <span class="k">else</span> <span class="mi">95</span>

    <span class="n">boot_style</span><span class="p">[</span><span class="s2">&quot;hz_line_width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">linewidth</span>
    <span class="n">boot_style</span><span class="p">[</span><span class="s2">&quot;vt_line_width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">linewidth</span>
    <span class="n">boot_style</span><span class="p">[</span><span class="s2">&quot;vt_line_color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">linecolor</span>
    <span class="n">boot_style</span><span class="p">[</span><span class="s2">&quot;hz_line_color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">linecolor</span>

    <span class="n">empty_style</span> <span class="o">=</span> <span class="n">NodeStyle</span><span class="p">()</span>
    <span class="n">empty_style</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">empty_style</span><span class="p">[</span><span class="s2">&quot;vt_line_width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">linewidth</span>
    <span class="n">empty_style</span><span class="p">[</span><span class="s2">&quot;hz_line_width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">linewidth</span>
    <span class="n">empty_style</span><span class="p">[</span><span class="s2">&quot;vt_line_color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">linecolor</span>
    <span class="n">empty_style</span><span class="p">[</span><span class="s2">&quot;hz_line_color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">linecolor</span>

    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">tree_ete3</span><span class="o">.</span><span class="n">traverse</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">support</span> <span class="o">&gt;=</span> <span class="n">support</span><span class="p">:</span>
            <span class="n">node</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="n">boot_style</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">node</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="n">empty_style</span><span class="p">)</span>

    <span class="n">column_layout</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">col_legend_rectface</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">metadata_colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">metadata_colors</span> <span class="o">=</span> <span class="s2">&quot;jet&quot;</span>

    <span class="c1"># If no metadata, do nothing</span>
    <span class="k">if</span> <span class="n">meta_data</span><span class="p">:</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">layout_attribute</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="n">column_layout</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">():</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span>
                <span class="n">rect_faces</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">meta_data</span><span class="p">))]</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">meta_data</span><span class="p">):</span>
                    <span class="n">colors</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_annot_to_color</span><span class="p">(</span><span class="n">col</span><span class="p">,</span>
                                                <span class="n">tree_ete3</span><span class="p">,</span>
                                                <span class="n">df_annot</span><span class="p">,</span>
                                                <span class="n">cmap</span><span class="o">=</span><span class="n">metadata_colors</span><span class="p">)</span>

                    <span class="n">rect_faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">RectFace</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span>
                                             <span class="n">fgcolor</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">name</span><span class="p">],</span>
                                             <span class="n">bgcolor</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
                    <span class="n">rect_faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">margin_left</span> <span class="o">=</span> <span class="mi">5</span>
                    <span class="n">rect_faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">margin_right</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">meta_data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">rect_faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">margin_right</span> <span class="o">=</span> <span class="mi">30</span>
                    <span class="n">add_face_to_node</span><span class="p">(</span><span class="n">rect_faces</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">node</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="n">column</span><span class="p">,</span>
                                     <span class="n">position</span><span class="o">=</span><span class="s1">&#39;aligned&#39;</span><span class="p">)</span>
                    <span class="n">column</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">tree_style</span><span class="o">.</span><span class="n">layout_fn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layout_attribute</span><span class="p">)</span>

        <span class="c1"># Add legend</span>
        <span class="n">legend_face</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">meta_data</span><span class="p">))]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">meta_data</span><span class="p">):</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">col_dict</span> <span class="o">=</span> <span class="n">_annot_to_color</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">tree_ete3</span><span class="p">,</span>
                                          <span class="n">df_annot</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">metadata_colors</span><span class="p">)</span>
            <span class="n">tree_style</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">TextFace</span><span class="p">(</span><span class="n">col</span><span class="p">,</span>
                                                <span class="n">fsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                                <span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                                       <span class="n">column</span><span class="o">=</span><span class="n">col_legend_rectface</span><span class="p">)</span>
            <span class="c1"># otherwise text is not in front of RectFace</span>
            <span class="n">tree_style</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">TextFace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">),</span>
                                       <span class="n">column</span><span class="o">=</span><span class="n">col_legend_rectface</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">legend_face</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">col_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">col_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">legend_face</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">RectFace</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">fgcolor</span><span class="o">=</span><span class="n">col_dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
                                               <span class="n">bgcolor</span><span class="o">=</span><span class="n">col_dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="n">legend_face</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">margin_right</span> <span class="o">=</span> <span class="mi">5</span>
                <span class="n">legend_face</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">margin_left</span> <span class="o">=</span> <span class="mi">10</span>
                <span class="n">tree_style</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">legend_face</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">key</span><span class="p">],</span>
                                           <span class="n">column</span><span class="o">=</span><span class="n">col_legend_rectface</span><span class="p">)</span>
                <span class="n">tree_style</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">TextFace</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">fsize</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
                                           <span class="n">column</span><span class="o">=</span><span class="n">col_legend_rectface</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">col_legend_rectface</span> <span class="o">+=</span> <span class="mi">2</span>
    <span class="n">column_layout</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">meta_data</span><span class="p">)</span> <span class="k">if</span> <span class="n">meta_data</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">t_xcor_seq</span><span class="p">:</span>
        <span class="n">tree_style</span><span class="p">,</span> <span class="n">column_layout</span> <span class="o">=</span> <span class="n">add_xcor_sequences_to_tree</span><span class="p">(</span>
            <span class="n">tree_style</span><span class="p">,</span> <span class="n">tree_ete3</span><span class="p">,</span> <span class="n">xcor_id</span><span class="p">,</span>
            <span class="n">xcor_seq</span><span class="p">,</span> <span class="n">column_start</span><span class="o">=</span><span class="n">column_layout</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">t_xcor_heatmap</span><span class="p">:</span>
        <span class="n">tree_style</span><span class="p">,</span> <span class="n">column_layout</span> <span class="o">=</span> <span class="n">add_heatmap_to_tree</span><span class="p">(</span>
            <span class="n">tree_style</span><span class="p">,</span> <span class="n">tree_ete3</span><span class="p">,</span> <span class="n">xcor_id</span><span class="p">,</span> <span class="n">xcor_seq</span><span class="p">,</span>
            <span class="n">matrix_type</span><span class="o">=</span><span class="n">matrix_type</span><span class="p">,</span>
            <span class="n">column_start</span><span class="o">=</span><span class="n">column_layout</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="n">colormap</span><span class="p">)</span>

    <span class="c1"># Add title</span>
    <span class="n">tree_style</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">TextFace</span><span class="p">(</span><span class="n">fig_title</span><span class="p">,</span> <span class="n">fsize</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">tree_style</span><span class="p">,</span> <span class="n">column_layout</span></div>



<div class="viewcode-block" id="add_xcor_sequences_to_tree">
<a class="viewcode-back" href="../../modules/generated/cocoatree.visualization.add_xcor_sequences_to_tree.html#cocoatree.visualization.add_xcor_sequences_to_tree">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">add_xcor_sequences_to_tree</span><span class="p">(</span><span class="n">tree_style</span><span class="p">,</span> <span class="n">tree_ete3</span><span class="p">,</span> <span class="n">xcor_id</span><span class="p">,</span> <span class="n">xcor_seq</span><span class="p">,</span>
                               <span class="n">column_start</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add XCoR sequence to ETE3&#39;s tree style</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    tree_style : ETE3&#39;s tree_style object</span>

<span class="sd">    tree_ete3 : ete3&#39;s tree object,</span>
<span class="sd">            as imported by io.load_tree_ete3()</span>

<span class="sd">    xcor_id : list of XCoR sequence identifiers, as imported by io.load_msa()</span>
<span class="sd">            the ids must match with the tree&#39;s leaves id</span>

<span class="sd">    xcor_seq : corresponding list of XCoR sequences to display,</span>
<span class="sd">            as imported by io.load_msa()</span>

<span class="sd">    column_start : int, optional, default : 0</span>
<span class="sd">        the column on which to start plotting</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tree_style : TreeStyle class from ete3</span>

<span class="sd">    column_end : int, the number of columns after the tree. If you want to</span>
<span class="sd">        plot anything else alongside the tree, the column number should be</span>
<span class="sd">        equal to this value.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xcor_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">xcor_id</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="nb">str</span><span class="p">(</span><span class="n">xcor_seq</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xcor_id</span><span class="p">))}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">layout_SeqMotifFace</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="n">column_start</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">xcor_dict</span><span class="p">:</span>
                <span class="n">seq</span> <span class="o">=</span> <span class="n">xcor_dict</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">seq</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">xcor_seq</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">seqFace</span> <span class="o">=</span> <span class="n">SeqMotifFace</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span>
                                   <span class="n">motifs</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">xcor_seq</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s2">&quot;seq&quot;</span><span class="p">,</span>
                                            <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]],</span>
                                   <span class="n">scale_factor</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">seqFace</span><span class="o">.</span><span class="n">margin_right</span> <span class="o">=</span> <span class="mi">30</span>
            <span class="n">add_face_to_node</span><span class="p">(</span><span class="n">seqFace</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="n">column</span><span class="p">,</span>
                             <span class="n">position</span><span class="o">=</span><span class="s1">&#39;aligned&#39;</span><span class="p">)</span>
    <span class="n">tree_style</span><span class="o">.</span><span class="n">layout_fn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layout_SeqMotifFace</span><span class="p">)</span>
    <span class="n">column_start</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">tree_style</span><span class="p">,</span> <span class="n">column_start</span></div>



<div class="viewcode-block" id="add_heatmap_to_tree">
<a class="viewcode-back" href="../../modules/generated/cocoatree.visualization.add_heatmap_to_tree.html#cocoatree.visualization.add_heatmap_to_tree">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">add_heatmap_to_tree</span><span class="p">(</span><span class="n">tree_style</span><span class="p">,</span> <span class="n">tree_ete3</span><span class="p">,</span> <span class="n">xcor_id</span><span class="p">,</span> <span class="n">xcor_seq</span><span class="p">,</span>
                        <span class="n">matrix_type</span><span class="o">=</span><span class="s2">&quot;identity&quot;</span><span class="p">,</span>
                        <span class="n">column_start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="s2">&quot;inferno&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add heatmap to ETE3&#39;s tree style</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    tree_style : ETE3&#39;s tree_style object</span>

<span class="sd">    tree_ete3 : ete3&#39;s tree object,</span>
<span class="sd">            as imported by io.load_tree_ete3()</span>

<span class="sd">    xcor_id : list of XCoR sequence identifiers, as imported by io.load_msa()</span>
<span class="sd">            the ids must match with the tree&#39;s leaves id</span>

<span class="sd">    xcor_seq : corresponding list of XCoR sequences to display,</span>
<span class="sd">            as imported by io.load_msa()</span>

<span class="sd">    matrix_type : str, default=&#39;identity&#39;</span>
<span class="sd">            whether to compute pairwise matrix identity (&#39;identity&#39;),</span>
<span class="sd">            similarity (&#39;similarity&#39;), or normalized similarity</span>
<span class="sd">            (&#39;norm_similarity&#39;)</span>

<span class="sd">    column_start : int, optional, default : 0</span>
<span class="sd">        the column on which to start plotting</span>

<span class="sd">    width : int, optional, default : 20</span>
<span class="sd">        the width of each square of the heatmap. If width == 20, the heatmap</span>
<span class="sd">        will be squared.</span>

<span class="sd">    colormap : str, optional, default: &quot;inferno&quot;</span>
<span class="sd">        any Matplotlib&#39;s colormap</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tree_style : TreeStyle class from ete3</span>

<span class="sd">    column_end : int, the number of columns after the tree. If you want to</span>
<span class="sd">        plot anything else alongside the tree, the column number should be</span>
<span class="sd">        equal to this value.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">leaves_id</span> <span class="o">=</span> <span class="n">tree_ete3</span><span class="o">.</span><span class="n">get_leaf_names</span><span class="p">()</span>
    <span class="n">nb_leaves</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">leaves_id</span><span class="p">)</span>

    <span class="c1"># allow to chose among Matplotlib&#39;s colormaps</span>
    <span class="n">ProfileFace</span><span class="o">.</span><span class="n">get_color_gradient</span> <span class="o">=</span> <span class="n">_get_color_gradient</span>

    <span class="c1"># Check that sequences in the similarity matrix are ordered as in the</span>
    <span class="c1"># tree leaves and keep only sequences that are present in the tree</span>
    <span class="n">sequences</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">xcor_id</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;seq&quot;</span><span class="p">:</span> <span class="n">xcor_seq</span><span class="p">})</span>
    <span class="n">reordered_sequences</span> <span class="o">=</span> <span class="n">sequences</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">leaves_id</span><span class="p">,</span> <span class="s2">&quot;seq&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="k">if</span> <span class="n">matrix_type</span> <span class="o">==</span> <span class="s1">&#39;identity&#39;</span><span class="p">:</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">compute_seq_identity</span><span class="p">(</span><span class="n">reordered_sequences</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">matrix_type</span> <span class="o">==</span> <span class="s1">&#39;similarity&#39;</span><span class="p">:</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">compute_seq_similarity</span><span class="p">(</span><span class="n">reordered_sequences</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">matrix_type</span> <span class="o">==</span> <span class="s1">&#39;norm_similarity&#39;</span><span class="p">:</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">compute_normalized_seq_similarity</span><span class="p">(</span><span class="n">reordered_sequences</span><span class="p">)</span>
    <span class="c1"># FIX to zero values appearing black in the heatmap whatever the cmap</span>
    <span class="n">matrix</span><span class="p">[</span><span class="n">matrix</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.00000001</span>
    <span class="n">min_v</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">matrix</span><span class="p">))</span>
    <span class="n">max_v</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">matrix</span><span class="p">))</span>
    <span class="n">center_v</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">min_v</span><span class="p">,</span> <span class="n">max_v</span><span class="p">]))</span>

    <span class="c1"># Add heatmap profile to each leaf</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">lf</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tree_ete3</span><span class="o">.</span><span class="n">iter_leaves</span><span class="p">()):</span>
        <span class="n">lf</span><span class="o">.</span><span class="n">add_features</span><span class="p">(</span><span class="n">profile</span><span class="o">=</span><span class="n">matrix</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">lf</span><span class="o">.</span><span class="n">add_features</span><span class="p">(</span><span class="n">deviation</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span>
        <span class="n">lf</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">ProfileFace</span><span class="p">(</span><span class="n">max_v</span><span class="o">=</span><span class="n">max_v</span><span class="p">,</span> <span class="n">min_v</span><span class="o">=</span><span class="n">min_v</span><span class="p">,</span> <span class="n">center_v</span><span class="o">=</span><span class="n">center_v</span><span class="p">,</span>
                                <span class="n">width</span><span class="o">=</span><span class="p">(</span><span class="n">nb_leaves</span><span class="o">*</span><span class="n">width</span><span class="p">),</span> <span class="n">height</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                                <span class="n">style</span><span class="o">=</span><span class="s1">&#39;heatmap&#39;</span><span class="p">,</span>
                                <span class="n">colorscheme</span><span class="o">=</span><span class="n">colormap</span><span class="p">),</span>
                    <span class="n">column</span><span class="o">=</span><span class="n">column_start</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;aligned&quot;</span><span class="p">)</span>
    <span class="n">column_start</span> <span class="o">+=</span> <span class="n">nb_leaves</span><span class="o">*</span><span class="n">width</span>
    <span class="k">return</span> <span class="n">tree_style</span><span class="p">,</span> <span class="n">column_start</span></div>

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>