name: Building and testing the package
on: [push]

jobs:
    run_tests:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout code üõéÔ∏è
              uses: actions/checkout@v2
              with:
                persist-credentials: false

            - name: Setup Miniconda
              uses: conda-incubator/setup-miniconda@v2
              with:
                auto-update-conda: true
                auto-activate-base: false
                miniconda-version: 'latest'
                python-version: 3.8
                environment-file: environment.yml
                activate-environment: tests
      
            - name: Install package
              shell: bash -l {0}
              run: |
                python -m pip install .

            - name: Run the tests
              shell: bash -l {0}
              run: |
                pushd ..
                pytest --showlocals -v --pyargs akasthesia
                popd

            - name: Build the documentation
              shell: bash -l {0}
              run: |
                pushd doc
                make html
                touch _build/html/.nojekyll
